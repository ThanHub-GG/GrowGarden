local function autoRejoinLoop()
    while getgenv().auto_rejoin do
        local hatchReady = false
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("Model") and obj:FindFirstChild("PetEgg") then
                local egg = obj.PetEgg
                local eggName = egg:GetAttribute("EggName")
                local timeToHatch = egg:GetAttribute("TimeToHatch")
                if eggName and eggName:lower() == getgenv().egg:lower() and timeToHatch == 0 then
                    hatchReady = true
                    break
                end
            end
        end

        if hatchReady then
            warn("[Egg Detected] Hatch Ready! Rejoin stopped.")
            getgenv().auto_rejoin = false
            break
        end

        pcall(function()
            game:GetService("TeleportService"):Teleport(game.PlaceId, game.Players.LocalPlayer)
        end)

        task.wait(5)
    end
end

local function startAutoEgg()
    task.spawn(function()
        while task.wait(2) do
            for _, obj in pairs(workspace:GetDescendants()) do
                if obj:IsA("Model") and obj:FindFirstChild("PetEgg") then
                    local egg = obj.PetEgg
                    local eggName = egg:GetAttribute("EggName")
                    if eggName and eggName:lower() == getgenv().egg:lower() then
                        local prompt = obj:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then
                            fireproximityprompt(prompt)
                        end
                    end
                end
            end
        end
    end)
end

game:GetService("Players").LocalPlayer.OnTeleport:Connect(function(state)
    if state == Enum.TeleportState.Failed or state == Enum.TeleportState.Started then
        if getgenv().auto_rejoin then
            autoRejoinLoop()
        end
    end
end)

startAutoEgg()
autoRejoinLoop()
